params {
    out_dir = './output'
    report_dir = './reports'
    custom_config_version       = 'master'
    custom_config_base          = "https://raw.githubusercontent.com/nf-core/configs/${params.custom_config_version}"
}

profiles {

  conda {
    executor = 'local'
    singularity.enabled = false
    docker.enabled = false
    conda.enabled = true
    process.conda = "${projectDir}/docker/conda.yaml"
    conda.useMamba = false
  }

  docker {
    executor = 'local'
    singularity.enabled = false
    singularity.autoMounts = false

    docker.enabled = true
    process.container = 'haniffalab/webatlas-pipeline:0.3.2'
  }

  sanger_lsf {
    process.container = 'haniffalab/webatlas-pipeline:0.3.2'

    docker.enabled = false
    singularity {
        enabled = true
        autoMounts = false
        runOptions = '--bind /lustre --bind /nfs --cleanenv --home /tmp'
    }
    executor {
        name = 'lsf'
        perJobMemLimit = true
        container = '/lustre/scratch127/cellgen/cellgeni/tickets/tic-2248/actions/docker--haniffalab--vitessce-pipeline--0.0.1.sif'
        jobName = { "$task.hash" }
        queue = 'imaging'
    }
  }
}

process {

    errorStrategy = { task.exitStatus in [130,137..140] ? 'retry' : 'terminate' }
    maxRetries = 5

    withLabel: small {
        cpus = 1
        memory = { 2.GB * task.attempt }
    }
    withLabel: large {
        cpus = { 4 * task.attempt }
        memory = { 20.GB * task.attempt }
    }
}
